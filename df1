FROM alpine/git as clone
WORKDIR /app
RUN git clone "https://github.com/AAGGroup/maven-web-application"


FROM eclipse-temurin:11-jdk-alpine as build
WORKDIR /app
COPY --from=clone /app/maven-web-application /app
RUN mvn install \
  && mvn sonar:sonar

FROM eclipse-temurin:17-jdk-jammy as deploy
ENV CATALINA_HOME /usr/local/tomcat
RUN mkdir -p "$CATALINA_HOME"
WORKDIR $CATALINA_HOME
COPY --from=build /app/target/*war $CATALINA_HOME
EXPOSE 8080
CMD ["catalina.sh", "run"]
